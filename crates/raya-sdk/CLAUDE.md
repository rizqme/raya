# raya-sdk

Lightweight SDK for writing Raya native modules.

## Overview

This crate provides the minimal types and traits needed to write Raya native modules **without** depending on the full `raya-engine`. Third-party native module authors only need this crate (plus `raya-native` for proc-macros).

## Key Types

### NativeValue

Opaque value type for FFI. Uses a tagged union internally.

```rust
#[repr(C)]
pub struct NativeValue {
    tag: u8,   // Type tag
    data: u64, // Payload (inline for primitives, pointer for heap)
}

// Constructors
NativeValue::null()
NativeValue::bool(true)
NativeValue::i32(42)
NativeValue::i64(9999999999)
NativeValue::f64(3.14)

// Accessors
value.is_null() -> bool
value.as_bool() -> Option<bool>
value.as_i32() -> Option<i32>
value.as_f64() -> Option<f64>
```

### NativeModule

Module registration container.

```rust
pub struct NativeModule {
    name: String,
    version: String,
    functions: HashMap<String, NativeFn>,
}

// Usage
let mut module = NativeModule::new("math", "1.0.0");
module.register_function("add", add_ffi);
```

### NativeFn

Function signature for native functions.

```rust
pub type NativeFn = extern "C" fn(
    args: *const NativeValue,
    arg_count: usize
) -> NativeValue;
```

### Conversion Traits

```rust
// From Raya value to Rust type
pub trait FromRaya: Sized {
    fn from_raya(value: NativeValue) -> Result<Self, NativeError>;
}

// From Rust type to Raya value
pub trait ToRaya {
    fn to_raya(self) -> NativeValue;
}

// Implemented for: i32, i64, f64, bool, ()
// Result<T, E> converts Ok(v) to v.to_raya(), Err to error value
```

## Usage Example

```rust
use raya_sdk::{NativeModule, NativeValue, FromRaya, ToRaya};
use raya_native::function;

#[function]
fn add(a: i32, b: i32) -> i32 {
    a + b
}

pub fn create_module() -> NativeModule {
    let mut module = NativeModule::new("math", "1.0.0");
    module.register_function("add", add_ffi); // add_ffi generated by #[function]
    module
}
```

## Design Principles

1. **Minimal dependencies**: Only `thiserror` for error types
2. **FFI-safe**: `#[repr(C)]` types, stable ABI
3. **No engine dependency**: Can be used without `raya-engine`
4. **Thread-safe**: `NativeValue` and `NativeModule` are `Send + Sync`

## For AI Assistants

- This crate is intentionally minimal - don't add engine dependencies
- `NativeValue` uses a tagged union, not an enum (for FFI stability)
- The `#[function]` macro from `raya-native` generates the FFI wrapper
- Heap values (strings, objects) use reference counting internally
- Error handling uses `NativeError` enum
